<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Простая аркада на JavaScript</title>
  <style>
    * {
      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #fafafa;
      font-family: Arial, sans-serif;
    }
    #game {
      position: relative;
      width: 60vw;
      max-width: 600px;
      height: 30vw;
      max-height: 300px;
      background: linear-gradient(to top, rgba(0, 0, 0, .1), transparent),
                  radial-gradient(ellipse at bottom, rgba(0, 0, 0, .2), transparent);
      border: 2px solid black;
      user-select: none;
      touch-action: none;
    }
    #player,
    #enemy {
      position: absolute;
      width: 40px;
      height: 50px;
      border-radius: 5px;
      transition: transform 0.1s ease-in-out;
    }
    #player {
      background: red;
      bottom: 50px;
      left: 50px;
    }
    #enemy {
      background: darkgreen;
      bottom: 50px;
      left: calc(100% - 100px); /* Старт справа */
    }
    #platform {
      position: absolute;
      width: 100%;
      height: 50px;
      background: green;
      bottom: 0;
      left: 0;
    }
    button#restart {
      position: fixed;
      z-index: 1000;
      top: 1rem;
      right: 1rem;
      padding: 0.5em 1em;
      cursor: pointer;
      outline: none;
      color: white;
      background-color: crimson;
      border: none;
      font-size: 16px;
      opacity: 0.7;
      transition: all 0.3s ease;
    }
    button#restart:hover {
      opacity: 1;
    }
  </style>
</head>
<body>
<div id="game">
  <div id="player"></div>
  <div id="enemy"></div>
  <div id="platform"></div>
</div>
<button id="restart">Перезагрузить игру</button>
<script>
  const game = document.querySelector('#game');
  const player = document.querySelector('#player');
  const enemy = document.querySelector('#enemy');
  const platform = document.querySelector('#platform');
  const restartButton = document.querySelector('#restart');

  const gameWidth = game.offsetWidth;
  const gameHeight = game.offsetHeight;
  const playerSize = 40;
  const enemySize = 40;

  let score = 0;
  let jumpVelocity = 0;
  let gravity = 0.8;
  let isJumping = false;
  let speed = 3;
  let friction = 0.85;
  let playerPosition = { x: 50, y: gameHeight - playerSize - 50 }; // начальная позиция игрока

  let enemyDirection = -speed; // направление перемещения врага (-1 вправо, 1 влево)
  let enemyPosition = { x: gameWidth - enemySize - 50, y: gameHeight - enemySize - 50 };

  const audio = new Audio(); // для звуковых эффектов

  const detectCollision = (rectA, rectB) =>
    rectA.x < rectB.x + rectB.width &&
    rectA.x + rectA.width > rectB.x &&
    rectA.y < rectB.y + rectB.height &&
    rectA.y + rectA.height > rectB.y;

  const updatePlayer = () => {
    playerPosition.y += jumpVelocity;
    jumpVelocity += gravity;

    if(playerPosition.y >= gameHeight - playerSize - 50) {
      playerPosition.y = gameHeight - playerSize - 50;
      jumpVelocity = 0;
      isJumping = false;
    }

    player.style.transform = `translate(${playerPosition.x}px, ${playerPosition.y}px)`;
  };

  const moveEnemy = () => {
    enemyPosition.x += enemyDirection;

    if(enemyPosition.x <= 0 || enemyPosition.x >= gameWidth - enemySize) {
      enemyDirection *= -1;
    }

    enemy.style.transform = `translate(${enemyPosition.x}px, ${enemyPosition.y}px)`;
  };

  const checkCollisions = () => {
    const playerRect = player.getBoundingClientRect();
    const enemyRect = enemy.getBoundingClientRect();

    if(detectCollision(playerRect, enemyRect)) {
      if(isJumping) {
        score++;
        enemy.style.backgroundColor = '#FFD700'; // меняем цвет противника при ударе
        playSound('assets/hit.mp3'); // воспроизводим звук удара
        resetEnemy();
      } else {
        gameOver();
      }
    }
  };

  const resetEnemy = () => {
    enemyPosition.x = Math.random() * (gameWidth - enemySize);
    enemyPosition.y = gameHeight - enemySize - 50;
    enemy.style.backgroundColor = 'darkgreen';
  };

  const gameOver = () => {
    alert(`Игра закончена!\nВаш счёт: ${score}`);
    location.reload();
  };

  const playSound = src => {
    audio.src = src;
    audio.play();
  };

  const handleKeyDown = event => {
    switch(event.keyCode) {
      case 37: // Left Arrow
        playerPosition.x -= speed;
        break;
      case 39: // Right Arrow
        playerPosition.x += speed;
        break;
      case 38: // Up Arrow
        if(!isJumping) {
          jumpVelocity = -15;
          isJumping = true;
        }
        break;
    }
  };

  const handleKeyUp = event => {
    switch(event.keyCode) {
      case 37: // Left Arrow
      case 39: // Right Arrow
        playerPosition.x *= friction;
        break;
    }
  };

  window.addEventListener('keydown', handleKeyDown);
  window.addEventListener('keyup', handleKeyUp);

  const gameLoop = () => {
    updatePlayer();
    moveEnemy();
    checkCollisions();
    requestAnimationFrame(gameLoop);
  };

  gameLoop();

  restartButton.onclick = () => location.reload();
</script>
</body>
</html>
